<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Low-latency Error Augmentation Framework for C++11">
<title>LEAF</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>LEAF</h1>
<div class="details">
<span id="author" class="author">Low-latency Error Augmentation Framework for C++11</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_abstract">Abstract</a></li>
<li><a href="#distribution">Distribution</a></li>
<li><a href="#building">Building</a></li>
<li><a href="#portability">Portability</a></li>
<li><a href="#tutorial">Tutorial</a></li>
<li><a href="#reference">Reference</a>
<ul class="sectlevel2">
<li><a href="#available"><code>available</code></a>
<ul class="sectlevel3">
<li><a href="#available_ctor">Constructor</a></li>
<li><a href="#available_dtor">Destructor</a></li>
<li><a href="#available::set_to_propagate"><code>set_to_propagate</code></a></li>
<li><a href="#available::rethrow_with_current_info"><code>rethrow_with_current_info</code></a></li>
<li><a href="#available::match"><code>match</code></a></li>
</ul>
</li>
<li><a href="#expect"><code>expect&lt;&gt;</code></a>
<ul class="sectlevel3">
<li><a href="#expect_ctor">Constructor</a></li>
<li><a href="#expect_dtor">Destructor</a></li>
</ul>
</li>
<li><a href="#unwrap"><code>unwrap</code></a></li>
<li><a href="#put"><code>put</code></a></li>
<li><a href="#throw_with_info"><code>throw_with_info</code></a></li>
<li><a href="#preload"><code>preload</code></a></li>
<li><a href="#has_current_error"><code>has_current_error</code></a></li>
<li><a href="#common">Common error info types</a></li>
<li><a href="#diagnostic_information"><code>diagnostic_information</code></a></li>
<li><a href="#current_exception_diagnostic_information"><code>current_exception_diagnostic_information</code></a></li>
<li><a href="#capture"><code>capture</code></a>
<ul class="sectlevel3">
<li><a href="#capture_ctors">Constructors</a></li>
<li><a href="#capture::release"><code>release</code></a></li>
</ul>
</li>
<li><a href="#transport"><code>transport</code></a></li>
<li><a href="#get"><code>get</code></a></li>
</ul>
</li>
<li><a href="#techniques">Programming techniques</a>
<ul class="sectlevel2">
<li><a href="#_capturing_errno_with_preload">Capturing <code>errno</code> with <code>preload</code></a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_abstract">Abstract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LEAF is a non-intrusive C++11 library for transporting arbitrary error information from contexts that detect and report failures, as well as from intermediate error-neutral contexts, to scopes where the error is ultimately handled.</p>
</div>
<div class="paragraph">
<p>LEAF does not allocate dynamic memory<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, which makes it suitable for low-latency and other performance-critical environments. It is compatible with all error handling APIs, and can be used with or without exception handling.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="distribution">Distribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LEAF is distributed under the <a href="http://www.boost.org/LICENSE_1_0.txt">Boost Software License, Version 1.0</a>.</p>
</div>
<div class="paragraph">
<p>The source code is available in <a href="https://github.com/zajo/leaf">this GitHub repository</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
LEAF is not part of Boost. Please post questions and feedback on the Boost Developers Mailing List.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building">Building</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LEAF is a header-only library and it requires no building. The unit tests use Boost Build, but the library itself has no dependency on Boost or any other library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="portability">Portability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LEAF requires a C++11 compiler. See unit test matrix at <a href="https://travis-ci.org/zajo/leaf">Travis-CI</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorial">Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s consider a function that reads data from a file into a buffer and returns an <code>error</code> enum to report errors:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">error file_read( FILE &amp; f, void * buf, int size ) {
	int n = fread(buf,1,size,&amp;f);

	if( ferror(&amp;f) ) { <i class="conum" data-value="1"></i><b>(1)</b>
		leaf::put( ei_errno { errno } );
		return file_read_error;
	}

	if( n!=size ) <i class="conum" data-value="2"></i><b>(2)</b>
		return file_read_error;

	return ok;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The function fails if <code>ferror</code> indicates an error.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It also fails if <code>fread</code> reports that it didn&#8217;t read all of the data requested.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>In the first case, there is a relevant <code>errno</code> code, so the function uses <code><a href="#put">put</a></code> to make it available later when the error is handled.</p>
</div>
<div class="paragraph">
<p>The second condition, while treated as a failure by our <code>file_read</code> function, is not a failure as far as <code>fread</code> is concerned, and therefore <code>errno</code> is not available. So in this case we simply return <code>file_read_error</code>.</p>
</div>
<div class="paragraph">
<p>The <code>ei_errno</code> struct is a simple error info type, defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">struct ei_errno { int value; };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The user can define any number of such types and, when an error is detected, pass them to <code><a href="#put">put</a></code> to make relevant information available to error handling contexts, if needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Error info types must define a public data member called <code>value</code> and must provide a <code>noexcept</code> move constructor and <code>noexcept</code> destructor. Any number of valid error info objects may be passed in a single call to <code><a href="#put">put</a></code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, let&#8217;s consider a possible caller of <code>file_read</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">error print_file( char const * file_name ) {
	std::shared_ptr&lt;FILE&gt; f;
	if( error err = file_open(file_name,f) ) <i class="conum" data-value="1"></i><b>(1)</b>
		return err;

	auto put = leaf::preload( ei_file_name {file_name } ); <i class="conum" data-value="2"></i><b>(2)</b>

	int s;
	if( error err = file_size(*f,s) )
		return err;

	std::string buffer( 1+s, '\0' );
	if( error err = file_read(*f,&amp;buffer[0],buffer.size()-1) )
		return err;

	std::cout &lt;&lt; buffer;
	std::cout.flush();
	if( std::cout.fail() )
		return cout_error;

	put.cancel();
	return ok;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This function takes a <code>file_name</code> argument and calls another function, <code>file_open</code> (not shown), that opens the file for reading. If that function reports a failure, we simply forward it to the caller.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Next, we call the convenience function <code><a href="#preload">preload</a></code>, moving an <code>ei_file_name</code> error info object into the temporary object <code>put</code>. Unless canceled, when this object is destroyed, all error info objects passed to <code>preload</code> will be forwarded by rvalue reference to <code><a href="#put">put</a></code> automatically. This way we can rest assured that the file name will be available with any failure reported by the several <code>return</code> statements in <code>print_file</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>print_file</code> uses preload only after <code>file_open</code> (not shown) has successfully opened the file. That&#8217;s because, presumably, <code>file_open</code> itself has the file name and will have already passed it to <code><a href="#put">put</a></code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>ei_file_name</code> type, similarly to <code>ei_errno</code>, is a simple struct containing a string <code>value</code>, e.g. <code>struct ei_file_name { std::string value; };</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If all functions called by <code>print_file</code> succeed, we call <code>put.<a href="#cancel">cancel</a>()</code>, to instruct its destructor to not forward the preloaded <code>ei_file_name</code> object to <code><a href="#put">put</a></code>, and return <code>ok</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If failures are reported by throwing exceptions, it is not necessary to call <code><a href="#cancel">cancel</a></code>; LEAF will use <code>std::unhandled_exception</code> to determine if a failure is being reported.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s consider the <code>main</code> function, which is able to handle errors reported by <code>print_file</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">int main( int argc, char const * argv[ ] ) {
	char const * fn;
	if( error err=parse_command_line(argc,argv,fn) ) { <i class="conum" data-value="1"></i><b>(1)</b>
		std::cout &lt;&lt; "Bad command line argument" &lt;&lt; std::endl;
		return 1;
	}

	leaf::expect&lt;ei_file_name,ei_errno&gt; info; <i class="conum" data-value="2"></i><b>(2)</b>

	switch( error err=print_file(fn) ) {
		case ok:
			return 0;

		case file_open_error: <i class="conum" data-value="3"></i><b>(3)</b>
			unwrap( info.match&lt;ei_file_name,ei_errno&gt;( [ ] ( std::string const &amp; fn, int errn ) {
				if( errn==ENOENT )
					std::cerr &lt;&lt; "File not found: " &lt;&lt; fn &lt;&lt; std::endl;
				else
					std::cerr &lt;&lt; "Failed to open " &lt;&lt; fn &lt;&lt; ", errno=" &lt;&lt; errn &lt;&lt; std::endl;
			} ) );
			return 2;

		case file_size_error:
		case file_read_error: <i class="conum" data-value="4"></i><b>(4)</b>
			unwrap(
				info.match&lt;ei_file_name,ei_errno&gt;( [ ] ( std::string const &amp; fn, int errn ) {
					std::cerr &lt;&lt; "Failed to access " &lt;&lt; fn &lt;&lt; ", errno=" &lt;&lt; errn &lt;&lt; std::endl;
				} ),
				info.match&lt;ei_errno&gt;( [ ] ( int errn ) {
					std::cerr &lt;&lt; "I/O error, errno=" &lt;&lt; errn &lt;&lt; std::endl;
				} ),
				info.match&lt;&gt;( [ ] {
					std::cerr &lt;&lt; "I/O error" &lt;&lt; std::endl;
				} ) );
			return 3;

		default: <i class="conum" data-value="5"></i><b>(5)</b>
			std::cerr &lt;&lt;
				"Unknown error code " &lt;&lt; err &lt;&lt; ", cryptic information follows." &lt;&lt; std::endl &lt;&lt;
				leaf::diagnostic_information();
			return 4;
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parse the command line to obtain a file name.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Tell LEAF that in case <code>print_file</code> reports an error, we expect to possibly have error info of type <code>ei_file_name</code> and/or <code>ei_errno</code> available.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In case <code>print_file</code> reports a <code>file_open_error</code>, if both <code>ei_file_name</code> and <code>ei_errno</code> are available, the call to <code><a href="#match">match</a></code> will succeed, and then <code><a href="#unwrap">unwrap</a></code> will pass both the <code>ei_file_name::value</code> and <code>ei_errno::value</code> to the supplied lambda. But if either <code>ei_file_name</code> or <code>ei_errno</code> is not available, <code>unwrap</code> will throw <code><a href="#mismatch_error">mismatch_error</a></code>, having failed to find a suitable <code><a href="#match">match</a></code>. Presumably (since this program does not use exception handling), this indicates that receiving a <code>file_open_error</code> without both <code>ei_file_name</code> and <code>ei_errno</code> available is a logic error.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Here we provide identical handling for either <code>file_size_error</code> or <code>file_read_error</code>, by first trying to <code><a href="#match">match</a></code> both <code>ei_file_name</code> and <code>ei_errno</code>; but if that fails, we&#8217;re prepared to deal with an error condition where only <code>ei_errno</code> is available. If neither is available, the final <code><a href="#match">match</a></code> will print a generic error message, thus guaranteeing that this call to <code>unwrap</code> will never throw.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Finally, the <code>default</code> case is designed to help diagnose logic errors where we got an error code which we forgot to handle. It prints the unrecognized error code, followed by <code><a href="#diagnostic_information">diagnostic_information</a></code>, which will print a complete, if not user-friendly, list of all available error info.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The complete program from this tutorial is available <a href="https://github.com/zajo/leaf/blob/master/example/print_file_ec.cpp">here</a>. There is also <a href="https://github.com/zajo/leaf/blob/master/example/print_file_eh.cpp">another</a> version of the same program that uses exception handling to report errors.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="available"><code>available</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/expect.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	class available {

		available( available const &amp; ) = delete;
		available &amp; operatar=( available const &amp; ) = delete;

public:

		available() noexcept;
		~available() noexcept

		void set_to_propagate() noexcept;

		[[noreturn]] void rethrow_with_current_info();

		template &lt;class... ErrorInfo,class F&gt;
		&lt;&lt;unspecified_type&gt;&gt; match( F &amp;&amp; f ) noexcept;

	};

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Class <code>available</code> is used to access any error info objects currently available in the calling thread (see <code><a href="#put">put</a></code>). Objects of class <code>available</code> are not copyable or moveable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Typically the functionality provided by class <code>available</code> is accessed through instancing the <code><a href="#expect">expect</a></code> class template, which derives from class <code>available</code>.
</td>
</tr>
</table>
</div>
<hr>
<div class="sect3">
<h4 id="available_ctor">Constructor</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	available::available() noexcept;

} }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<p>Initializes an <code>available</code> instance so that when it is destroyed it will reset (clear) all error info objects that are currently available in the calling thread. This behavior can be disabled by a call to <code><a href="#set_to_propagate">set_to_propagate</a></code>.</p>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="available_dtor">Destructor</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	available::~available() noexcept;

} }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<p>Unless the user has called <code><a href="#set_to_propagate">set_to_propagate</a></code>, resets (clears) all error info objects that are currently available in the calling thread.</p>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="available::set_to_propagate"><code>set_to_propagate</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	void available::set_to_propagate() noexcept;

} }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<p>By default, <code><a href="#available_dtor">~available</a></code> will reset (clear) all error info objects that are currently available in the calling thread (see <code><a href="#put">put</a></code>). Call <code>set_to_propagate</code> to disable this behavior.</p>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="available::rethrow_with_current_info"><code>rethrow_with_current_info</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	void available::rethrow_with_current_info();

} }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<p>Equivalent to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">set_to_propagate();
throw;</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="available::match"><code>match</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	template &lt;class... ErrorInfo,class F&gt;
	&lt;&lt;unspecified_type&gt;&gt; available::match( F &amp;&amp; f ) noexcept;

} }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Returns: </dt>
<dd>
<p>An object of unspecified type designed to be passed directly to <code><a href="#unwrap">unwrap</a></code>, which takes any number of such objects, and proceeds to inspect them in order, until it finds a match where error info objects are currently available in the calling thread (see <code><a href="#put">put</a></code>) for all specified <code>ErrorInfo&#8230;&#8203;</code> types. If found, <code>unwrap</code> invokes <code>f</code>, passing the <code>.value</code> of each available error info object.</p>
</dd>
<dt class="hdlist1">Throws: </dt>
<dd>
<p>If <code>unwrap</code> is unable to find a suitable match, it throws<sup class="footnote" id="_footnote_onlythrow">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> <code><a href="#mismatch_error">mismatch_error</a></code>.</p>
</dd>
</dl>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="expect"><code>expect&lt;&gt;</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/expect.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	template &lt;class... ErrorInfo&gt;
	class expect: public availablej {

		expect( expect const &amp; ) = delete;
		expect &amp; operator=( expect const &amp; ) = delete;

	public:

		expect() noexcept;
		~expect() noexcept;

	};

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>expect</code> class template is used to communicate to LEAF that error info objects of the specified <code>ErrorInfo&#8230;&#8203;</code> types are expected in the current scope, to help handle failures.</p>
</div>
<div class="paragraph">
<p><code>expect</code> objects are not copyable or movable. They form a hierarchy, such that error info types requested higher up the call chain remain open in lower scopes, regardless of whether or not they&#8217;re specified in lower level <code>expect</code> instances.</p>
</div>
<hr>
<div class="sect3">
<h4 id="expect_ctor">Constructor</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	expect&lt;class ErrorInfo...&gt;::expect() noexcept;

} }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Provides storage for objects of the specified <code>ErrorInfo&#8230;&#8203;</code> types, enabling the <code><a href="#put">put</a></code> function template for use with these types within the current scope. When an error info object is passed to <code>put</code>, it is discarded unless the call originates in a scope where that specific error info type is expected.</p>
</li>
<li>
<p>Resets (clears) all error info objects that are currently available. Note, the reset is <em>not</em> limited to the specified <code>ErrorInfo&#8230;&#8203;</code> types.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="expect_dtor">Destructor</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	expect&lt;class ErrorInfo...&gt;::~expect*( noexcept;

} }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The storage provided by the <code>expect</code> constructor for error info objects is removed, except for error info types specified in other active <code>expect</code> instances up the call stack.</p>
</li>
<li>
<p>If <code><a href="#has_current_error">has_current_error</a></code> is <code>true</code>, calls <code><a href="#set_to_propagate">set_to_propagate</code></a>.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="unwrap"><code>unwrap</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/expect.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	struct mismatch_error: std::exception { };

	template &lt;class... Match&gt;
	void unwrap( Match &amp;&amp; ... m );

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<p><code>unwrap</code> takes any number of objects returned by <code><a href="#match">match</a></code>, and proceeds to inspect them in order, until it finds a match where error info objects are currently available in the calling thread (see <code><a href="#put">put</a></code>) for all <code>ErrorInfo&#8230;&#8203;</code> types used to instantiate the <code><a href="#match">match</a></code> function template. If found, <code>unwrap</code> invokes the function <code>f</code> (passed to <code>match</code>), passing the <code>.value</code> of each available error info object.</p>
</dd>
<dt class="hdlist1">Throws: </dt>
<dd>
<p>If no match is found, <code>unwrap</code> throws<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> <code><a href="#mismatch_error">mismatch_error</a></code>.</p>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="put"><code>put</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/put.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	template &lt;class... ErrorInfo&gt;
	void put( ErrorInfo &amp;&amp; ... info ) noexcept;

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<p>Moves each specified <code>info</code> object of type that is expected in the calling thread, into the storage provided by <code><a href="#expect">expect</a></code>. All such <code>info</code> objects can be accessed by objects of class <code><a href="#available">available</a></code> or of an instance of the <code>expect</code> template.</p>
<div class="paragraph">
<p>All other <code>info</code> objects are discarded.</p>
</div>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="throw_with_info"><code>throw_with_info</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/put.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	template &lt;class... ErrorInfo,class Exception&gt;
	[[noreturn]] void throw_with_info( Exception const &amp; e, ErrorInfo &amp;&amp; ... info );

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<p>As if:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">put(std::forward&lt;ErrorInfo&gt;(info)...);
throw e;</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="preload"><code>preload</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/put.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	template &lt;class... ErrorInfo&gt;
	&lt;&lt;unspecified_type&gt;&gt; preload( ErrorInfo &amp;&amp; ... info );

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Returns: </dt>
<dd>
<p>An object of unspecified moveable type which holds copies of all the passed <code>info</code> objects. Upon its destruction the stored copies are all forwarded by rvalue reference to <code><a href="#put">put</a></code>, except that:</p>
<div class="ulist">
<ul>
<li>
<p>If <code><a href="#has_current_error">has_current_error</a></code> is <code>false</code>, or the user calls  <code>cancel</code> (a member function of the returned object), all preloaded error info objects are discarded.</p>
</li>
<li>
<p>If any of the <code>info</code> objects passed to <code>preload</code> is a function, it is expected to return the actual error info object to be passed to <code>put</code>, and the function call to obtain it is deferred until the object returned by <code>preload</code> is destroyed (think <code>errno</code>, which obviously should not be captured at the time <code>preload</code> is called).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="has_current_error"><code>has_current_error</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/has_current_error.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	bool has_current_error() noexcept;
	void set_has_current_error( bool (*f)() ) noexcept;

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>LEAF uses <code>has_current_error</code> to determine if an error is currently being propagated up the call stack. By default, <code>has_current_error</code> returns <code>std::unhandled_exception()</code>. Use <code>set_has_current_error</code> to hook up a different implementation, if needed</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>has_current_error</code> is an optimization, for example when using <code><a href="#preload">preload</a></code>, the call to <code><a href="#put">put</a></code> will be skipped unless <code>has_current_error</code> returns <code>true</code>. It is valid to pass to <code>set_has_current_error</code> a function which always returns <code>true</code>.
</td>
</tr>
</table>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="common">Common error info types</h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/common.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	struct ei_api_function { char const * value; };
	struct ei_file_name { std::string value; };

	struct ei_errno {
		int value;
		friend std::ostream &amp; operator&lt;&lt;( std::ostream &amp; os, ei_errno const &amp; err );
	};

	ei_errno get_errno() noexcept {
		return ei_errno { return errno };
	}

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This header defines some common error info objects which can be used directly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>ei_api_function</code> type is designed to capture the name of the function for which a failure is reported. For example, if you&#8217;re reporting an error detected by <code>fread</code>, you could use <code>leaf::ei_api_function { "fread" }</code>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The passed value is stored as a C string, so you should only pass string literals for <code>value</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>When a file operation fails, you could use <code>ei_file_name</code> to capture the name of the file.</p>
</li>
<li>
<p><code>ei_errno</code> is suitable to capture <code>errno</code>.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If using <code><a href="#preload">preload</a></code>, please pass <code>&amp;get_errno</code> instead of an instance of <code>ei_errno</code>; this way <code>errno</code> will be captured after the error is detected, rather than at the time <code>preload</code> is called.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>ei_errno</code> objects can be stremed to a <code>std::ostream</code>, which uses <code>strerror</code> to convert the <code>errno</code> code to a friendlier error message. This is designed for use with <code><a href="#diagnostic_information">diagnostic_information</a></code>.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="diagnostic_information"><code>diagnostic_information</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/diagnostic_information.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	class diagnostic_information {

		diagnostic_information( diagnostic_information const &amp; ) = delete;
		diagnostic_information &amp; operator=( diagnostic_information const &amp; ) = delete;

	public:

		diagnostic_information() noexcept();

		friend std::ostream &amp; operator&lt;&lt;( std::ostream &amp;, diagnostic_information const );
	};

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The only operation supported by class <code>diagnostic_information</code> is <code>operator&lt;&lt;</code> which, when used with a <code>std::ostream</code> outputs a developer-friendly string representation of all of the currently available error info objects.</p>
</div>
<div class="paragraph">
<p>Each error info object is output based on the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If its type defines a suitable <code>operator&lt;&lt;</code> overload, it is used by the <code>operator&lt;&lt;</code> overload for <code>diagnostic_information</code> directly; otherwise</p>
</li>
<li>
<p>If the type of its <code>value</code> data member defines a suitable <code>operator&lt;&lt;</code> overload, it will be used instead.</p>
</li>
<li>
<p>Otherwise the error info type can not be output by <code>diagnostic_information</code>. This is valid, using such error info types will not result in a compile error.</p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="current_exception_diagnostic_information"><code>current_exception_diagnostic_information</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/current_exception_diagnostic_information.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	class current_exception_diagnostic_information {

		current_exception_diagnostic_information( current_exception_diagnostic_information const &amp; ) = delete;
		current_exception_diagnostic_information &amp; operator=( current_exception_diagnostic_information const &amp; ) = delete;

	public:

		current_exception_diagnostic_information() noexcept();

		friend std::ostream &amp; operator&lt;&lt;( std::ostream &amp;, current_exception_diagnostic_information const );
	};

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The only operation supported by class <code>current_exception_diagnostic_information</code> is <code>operator&lt;&lt;</code> which, when used with a <code>std::ostream</code> outputs a developer-friendly information about the current unhandled exception, followed by the output of <code><a href="#diagnostic_information">diagnostic_information</a></code>.</p>
</div>
<div class="paragraph">
<p>Typical use for <code>current_exception_diagnostic_information</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">catch(...) {
	std::cerr &lt;&lt; Unhandled exception! &lt;&lt; std::endl &lt;&lt;
		leaf::current_exception_diagnostic_information();
}</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="capture"><code>capture</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/capture.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	class capture {

		capture( capture const &amp; ) = delete;
		capture &amp; operator=( capture const &amp; ) = delete;

	public:

		capture() noexcept;
		capture( capture &amp;&amp; ) noexcept;
		release() noexcept;

	};

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Objects of class <code>capture</code> can be used to transport the currently available error info objects from one thread to another.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To transport error info objects between threads, it is usually preferable to use the higher level functions <code><a href="#transport">transport</a></code> and <code><a href="#get">get</a></code>, though they require exception handling.
</td>
</tr>
</table>
</div>
<hr>
<div class="sect3">
<h4 id="capture_ctors">Constructors</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	capture::capture() noexcept;
	capture::capture( capture &amp;&amp; ) noexcept;

} }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The default constructor moves all of the currently available (in the calling thread) exception info objects into a dynamically-allocated buffer stored in the <code>capture</code> object.</p>
</li>
<li>
<p>The move constructor does not throw.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="capture::release"><code>release</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	void capture::release() noexcept;

} }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moves all exception info objects captured from the thread in which <code>this</code> was initialized, and makes them available in the calling thread.</p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="transport"><code>transport</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/transport.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	template &lt;class... ErrorInfo,class F&gt;
	&lt;&lt;unspecified&gt;&gt; transport( F f )

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Returns: </dt>
<dd>
<p>A function object which, when called:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Performs the same operations as the constructor of  <code><a href="#expect">expect</a>&lt;ErrorInfo&#8230;&#8203;&gt;</code>, then</p>
</li>
<li>
<p>forwards all of its arguments to <code>f</code>, and returns the return value of <code>f</code>.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The returned function is designed to be used as a wrapper for <code>f</code> when it&#8217;s passed to <code>std::async</code> or <code>std::packaged_task</code> and launched in a worker thread.</p>
</div>
<div class="paragraph">
<p>Later the user is expected to call <code><a href="#get">get</a></code> instead of <code>std::future::get</code> directly; this way, in case <code>f</code> throws, all of the error info objects are effectivey transported (together with the exception object) from the worker thread into the waiting thread.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Click <a href="https://github.com/zajo/leaf/blob/master/example/transport_between_threads.cpp">here</a> to see a complete example on transporting error info objects between threads.
</td>
</tr>
</table>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="get"><code>get</code></h3>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">#include &lt;boost/leaf/transport.hpp&gt;</div>
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">namespace boost { namespace leaf {

	template &lt;class Future&gt;
	decltype(std::declval&lt;Future&gt;().get()) get( Future &amp; f );

} }</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Effects: </dt>
<dd>
<p>This function simply returns <code>f.get()</code>, expecting that <code>f</code> is of type <code>std::future&lt;&gt;</code> or another similar type that defines a <code>get</code> member function, to obtain the result from a worker thread started using <code><a href="#transport">transport</a></code>. In case the worker thread throws, all error info objects from the worker thread are automatically made available in the calling thread.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There is no need to use <code><a href="#expect">expect</a></code> when calling <code><a href="#get">get</a></code>; in case a worker thread throws an exception, <em>all</em> available error info objects are trasported and made available in the calling thread.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Click <a href="https://github.com/zajo/leaf/blob/master/example/transport_between_threads.cpp">here</a> to see a complete example on transporting error info objects between threads.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="techniques">Programming techniques</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_capturing_errno_with_preload">Capturing <code>errno</code> with <code>preload</code></h3>
<div class="paragraph">
<p>Typically, when calling <code><a href="#preload">preload</a></code> we pass in the actual error info object(s) that we want forwarded to <code><a href="#put">put</a></code>. This copies them into the returned temporary object. Later, if we report an error from the same function, the destructor of the temporary object will forward all of its contents to <code><a href="#put">put</a></code> by rvalue reference.</p>
</div>
<div class="paragraph">
<p>But this behavior is incorrect for capturing <code>errno</code>. Consider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">error read_file( FILE &amp; f ) {
	auto put = leaf::preload( ei_errno { errno } ); //incorrect
	....
	if( ferror(&amp;f) )
		return my_error;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem is that <code>errno</code> must not be captured before it is set by a failed operation. The solution is to instead pass a function to <code>preload</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c++" data-lang="c++">error read_file( FILE &amp; f ) {
	auto put = leaf::preload( [ ] { return ei_errno { errno }; );
	....
	if( ferror(&amp;f) )
		return my_error;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>preload</code> is passed a function, obtaining the error info object is deferred until the temporary object is being destroyed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The header <code>boost/leaf/common.hpp</code> defines a function called <code>get_errno</code> which can be used for capturing <code>errno</code>, rather than using a lambda each time.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Except when transporting error info between threads, see <a href="#capture"><code>capture</code></a>.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. This is the only LEAF function that throws.
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>